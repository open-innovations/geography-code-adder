<!DOCTYPE html>
<html lang="en">
<head>
	<title>Add UK geography codes</title>
	<link rel="icon" href="https://open-innovations.org/resources/images/logos/oi-square-5.svg" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta charset="utf-8" />
	<link rel="StyleSheet" href="resources/style.css" type="text/css" />
	<style>
	html {
		scroll-behavior: smooth;
	}
	.container { display: flex; height: 100vh; max-height: 100vh; flex-direction: column; }
	#main { flex-grow: 1; }
	header { display: flex; }
	header h1 {
		flex-grow: 1;
		padding: 1rem;
		display: inline-block;
		position: relative;
		font-size: 1.4rem;
	}
	header h1 img {
		margin-right: 0.25em;
		float: left;
		width: 1em;
		height: 1em;
	}
	header .info { padding: 1rem; line-height: 0; }
	nav { border-bottom: 1px solid #222; box-shadow: 0 4px 3px -4px rgba(0,0,0,0.25); z-index: 1; display: flex; }
	nav button, nav div { line-height: 1.5rem; margin-right: 1px; padding: 0.5em; }
	nav button.icon { line-height: 0; }
	nav button svg { height: 1.5rem; }
	nav #msg-start-edit { flex-grow: 1; text-align: right; padding-inline: 1rem; }

	#messages .message { border-bottom: 1px solid #222; }
	button:disabled { background: #999; }
	.chooser { text-align: left; display: flex; flex-wrap: wrap; line-height: 1.5rem; gap: 1rem; align-items: stretch; justify-content: center; margin-bottom: 1rem; }
	.chooser input { font-size:1em; }
	.chooser .vs { font-family: serif; font-style: italic; color: #666666; align-self: center; }
	.chooser .part { flex-grow: 1; position: relative; margin: 0px; }
	.chooser .part > *:last-child { margin-bottom: 0; }
	.chooser .part input { padding: 0px 2px; }
	.chooser .part label { display: block; }
	.chooser .choose { display: inline; }
	.chooser .choose button { height: 100%; margin-left: 1em; }
	#validation_form { margin-bottom: 1rem; }
	#url {
		line-height: 1.5em;
		width: 100%;
	}
	form { 
		position: relative;
	}
	.dropzone {
		line-height: 1.5em;
		position: absolute;
		left: 0px;
		top: 0px;
		padding: 1em;
		box-sizing: border-box;
	}
	.dropzone.loaded {
		border: 2px solid transparent;
	}
	.dropzone.loaded .helpertext {
		display: none;
	}
	.dropzone.drop {
		background-color: #efefef;
		outline: 2px dashed #999999;
	}
	.dropzone input {
		position: absolute;
		left: 0px;
		top: 0px;
		width: 100%;
		height: 100%;
		opacity: 0.01;
	}
	#config { margin-top: 1rem; display: flex; gap: 1rem; }
	#output { position: relative; width: 100%; }
	select,input { font-size: 1em; line-height: 2em; height: 2em; border-radius: 4px; border: 1px solid #999; }
	input.button { height: 2.25em; border-radius: 0; }
	textarea { font-size: 1em; padding: 0.5rem; }

	.table-holder { width: 100%; overflow-x: auto; margin: 0; }
	table th { border-top: 0px; }
	table th:focus { outline: 2px solid #1DD3A7; }
	table th:first-child, table td:first-child { border-left: 0; }
	table th:last-child, table td:last-child { border-right: 0; }
	table, table .row { -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; }
	table .row { text-align: right; }
	table th, table .row { cursor: pointer; background: #ddd; }
	table td, table th { min-height: 1em; padding: 0.125em 0.25em; line-height: 1.25em; }
	td[aria-multiselectable] { background: rgba(249, 188, 38,0.4); }
	th[aria-multiselectable], td.row[aria-multiselectable] { background: rgba(249, 188, 38,0.7); }
	svg.bi { width: 1.5em; height: 1.5em; vertical-align:middle; cursor: pointer; }
	.bigpadding { padding-block: 3rem; }
	footer { display: none; }
	.modal { position: absolute; z-index: 100; width: 100vw; height: 100vh; background: rgba(255,255,255,0.5); top: 0; left: 0; }
	.modal-inner { position: absolute; z-index: 100; box-shadow: 0 4px 3px -4px rgba(0,0,0,0.25); border: 1px solid #999; max-width: 100%; width: 640px; padding: 2rem; top: 50%; left: 50%; transform: translate3d(-50%,-50%,0); }
	</style>
	<script type="text/javascript" src="resources/oi.logger.js"></script>
	<script type="text/javascript" src="resources/editor.js"></script>
	<script type="text/javascript" src="resources/oi.csveditor.js"></script>
</head>
<body class="b1-bg">

	<div class="container">
		<header class="b1-bg">
			<h1><a href="https://open-innovations.org/projects/hexmaps/"><img src="https://open-innovations.org/resources/images/logos/oi-square-5.svg" style="height: 1em;"></a> Add UK geography codes</h1>
		</header>

		<nav id="navigation" class="b3-bg"></nav>

		<div id="main" class="b6-bg">
			<div id="messages"></div>

			<div id="output">
				<div class="holder padded cen bigpadding">
					<div class="warning msg message padded-bottom">
						<div class="holder cen">This is a work-in-progress so may not be fully functional.</div>
					</div>

					<p>If you have a CSV file that has a column with named UK geographies and want to add a column of GSS codes, this tool can help. For example, say you have a column that lists "Leeds", "Birmingham", "Salford" etc, it would add a column with the codes <code>E08000035</code>, <code>E08000025</code> and <code>E08000006</code>.</p>
					<p>Press <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" width="1em" height="1em" class="btn-open bi bi-folder-fill" viewBox="0 0 16 16"><path d="M9.828 3h3.982a2 2 0 0 1 1.992 2.181l-.637 7A2 2 0 0 1 13.174 14H2.825a2 2 0 0 1-1.991-1.819l-.637-7a2 2 0 0 1 .342-1.31L.5 3a2 2 0 0 1 2-2h3.672a2 2 0 0 1 1.414.586l.828.828A2 2 0 0 0 9.828 3m-8.322.12q.322-.119.684-.12h5.396l-.707-.707A1 1 0 0 0 6.172 2H2.5a1 1 0 0 0-1 .981z"/></svg> to load a CSV file.</p>
				</div>
			</div>
			
			<div role="dialog" id="dialog-open" aria-labelledby="dialog-open-label" style="display:none;">
				<div class="tallpadded padded holder bigpadding">
					<h2 id="dialog-open-label">Load a CSV</h2>
					<form id="validation_form" name="validation_form" submit="return true;" method="POST" enctype="multipart/form-data" accept-charset="UTF-8">
						<div class="chooser">
							<div class="part padded b5-bg">
								<!--<label for="url">URL</label><input id="url" type="url" name="url" class="" placeholder="e.g. https://odileeds.github.io/hexmaps/data/wards-leeds.csv" pattern="https://.*" />-->
								<label for="url"><strong>Load URL</strong> (CSV or Google Sheet)</label><input id="url" type="text" name="url" class="" placeholder="e.g. OpenDataBidsAprtoJun2024.csv">
								<p>Or load an <a href="OpenDataBidsAprtoJun2024.csv" class="example">example of Leeds wards</a> (<a href="https://datamillnorth.org/dataset/20jjj/council-house-bids">from Data Mill North</a>)</p>
							</div>
							<div class="vs">or</div>
							<div class="part padded b5-bg dropzone" id="drop_zone">
								<label for="standard_files"><strong>Load file</strong></label>
								<div class="helpertext">Drop a .csv or .hexjson file here (or click to browse files)</div>
								<input id="standard_files" class="fileselect" type="file" title="browse" name="file" accept=".csv, .hexjson">
								<div class="info"></div>
							</div>
						</div>
						<button id="cancel" class="b2-bg">Cancel</button>
						<input id="reset" type="reset" class="b2-bg button" value="Reset"/>
						<button id="btnSubmit" type="submit" class="button c5-bg">Load data</button>
					</form>
				</div>
			</div>

			<div role="dialog" id="dialog-config" aria-labelledby="dialog-config-label" style="display:none;">
				<div id="dialog-config-messages"></div>
				<div id="add-geo-config" class="padded">
					<h2>Add GSS codes</h2>
					<div class="row">
						<label for="geography-type">Geography type:</label>
						<select id="geography-type">
							<option value=""></option>
							<option value="LAD">Local Authorities</option>
							<option value="WD">Wards</option>
							<option value="PCON">Constituencies</option>
						</select>
					</div>
					<div class="row">
						<label for="geography-year">Geography year:</label>
						<input type="number" min="2010" max="2024" id="geography-year">
					</div>
				</div>
				<button id="geography-add" type="submit" class="button c5-bg">Add codes</button>
			</div>
		</div>

		<footer class="b1-bg">
			<div class="holder tallpadded padded">
				<h2>Credits</h2>
				<p>This open source project is made possible thanks to other open source and open data projects:</p>

				<ul>
					<li>&copy; 2024 Stuart Lowe, Open Innovations (MIT licence). <a href="https://github.com/open-innovations/geography-code-adder/">Code on GitHub</a>.</li>
					<li>Data from the Office of National Statistics' <a href="https://geoportal.statistics.gov.uk/datasets/d7be63c8bd144ae0a26c6593eb5e00b7/about">Code History Database (July 2024) for the UK</a> (<a href="https://www.ons.gov.uk/methodology/geography/licences">OGL v.3.0</a>)</li>
				</ul>
			</div>
		</footer>
	</div>

	<script src="https://open-innovations.org/resources/oi.log.js"></script>
	<script>
	OI.log.setup({'id':'odileeds','target':['open-innovations.org','open-innovations.github.io']}).add('action=view');
	</script>
</body>
</html>
